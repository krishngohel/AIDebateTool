<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Welcome • AI Debate Tool</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <section id="welcomeScreen">
    <div class="welcome-card">
      <h1>Welcome to the AI Debate Tool</h1>
      <p class="muted">Please fill this out to get started.</p>

      <!-- On submit, browser navigates to /debate -->
      <form id="welcomeForm" action="/debate" novalidate>
        <div class="field-row">
          <label for="firstName">First name</label>
          <input id="firstName" type="text" required maxlength="30" autocomplete="given-name" />
        </div>

        <div class="field-row">
          <label for="lastInitial">Last initial</label>
          <div class="inline">
            <input id="lastInitial" type="text" required maxlength="1" pattern="[A-Za-z]" />
            <small class="hint">One letter (A–Z).</small>
          </div>
        </div>

        <div class="field-row">
          <label for="gradeSelect">Grade</label>
          <select id="gradeSelect" required>
            <option value="">Select grade</option>
            <option value="6">6th Grade</option>
            <option value="7">7th Grade</option>
            <option value="8">8th Grade</option>
            <option value="Other">Other (type below)</option>
          </select>

          <!-- Shown only if "Other" is selected -->
          <input
            id="gradeCustom"
            class="hidden"
            type="text"
            maxlength="32"
            placeholder="e.g., 5th Grade, College Sophomore, Adult Learner, Graduated"
          />
        </div>

        <div class="field-row">
          <label for="difficulty">Difficulty</label>
          <select id="difficulty" required>
            <option value="" disabled selected>Select difficulty</option>
            <option>Beginner</option><option>Intermediate</option>
            <option>Normal</option><option>Hard</option><option>Extreme</option>
          </select>
        </div>

        <button id="startBtn" class="btn-primary" type="submit">Start Debating</button>
      </form>
    </div>
  </section>

  <script>
  // Save to localStorage, then let the form navigate to /debate
  document.addEventListener("DOMContentLoaded", () => {
    const SETTINGS_KEY = "debate_user_settings_v1";
    const form        = document.getElementById("welcomeForm");
    const startBtn    = document.getElementById("startBtn");
    const firstName   = document.getElementById("firstName");
    const lastInitial = document.getElementById("lastInitial");
    const gradeSelect = document.getElementById("gradeSelect");
    const gradeCustom = document.getElementById("gradeCustom");
    const difficulty  = document.getElementById("difficulty");

    // Toggle custom grade input
    gradeSelect.addEventListener("change", () => {
      const needsCustom = gradeSelect.value === "Other";
      gradeCustom.classList.toggle("hidden", !needsCustom);
      gradeCustom.required = needsCustom;
      if (!needsCustom) gradeCustom.value = "";
    });

    function getSelectedGrade() {
      const val = gradeSelect.value;
      if (val === "Other") {
        return gradeCustom.value.trim() || "Other";
      }
      return val; // "6" | "7" | "8"
    }

    startBtn?.addEventListener("click", () => form.requestSubmit());

    form.addEventListener("submit", (e) => {
      // Let the browser handle required fields; if any missing, it will prevent navigation
      const fName = (firstName?.value || "").trim();
      const lInit = (lastInitial?.value || "").trim().slice(0,1).toUpperCase();
      const grd   = getSelectedGrade();
      const diff  = (difficulty?.value || "").trim();

      if (!fName || !lInit || !grd || !diff) return; // let browser validation show issues

      localStorage.setItem(SETTINGS_KEY, JSON.stringify({
        firstName: fName,
        lastInitial: lInit,
        grade: grd,
        difficulty: diff,
        topic: null,
        ts: Date.now()
      }));
      // Navigation will proceed to /debate because of form action
    });
  });
  </script>
</body>
</html>
